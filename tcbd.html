<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒŸ Happy Birthday TC! (12/14) - Shirley ğŸ‚</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Vidaloka&display=swap" rel="stylesheet">

    <style>
        :root {
            --morandi-blue: #A9B7C7; 
            --sapphire-bg: #08122C; 
        }
        
        body {
            margin: 0;
            overflow: hidden; 
            font-family: 'Vidaloka', 'Georgia', serif; 
            background-color: var(--sapphire-bg); 
            color: white; 
        }

        #container {
            width: 100vw;
            height: 100vh;
        }

        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; 
            z-index: 10;
        }
        
        /* è²éŸ³æç¤ºæŒ‰éˆ• (å³ä¸Šè§’) */
        #audio-prompt {
            position: fixed;
            top: 20px; 
            right: 20px; 
            pointer-events: auto; 
            background: rgba(44, 62, 80, 0.9);
            color: white;
            padding: 10px 16px; 
            border-radius: 50px; 
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            transition: opacity 0.5s, transform 0.3s, background-color 0.5s;
            z-index: 100; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
            border: none;
            font-size: 1.1em;
            font-weight: bold;
        }
        
        #audio-prompt:hover {
            transform: scale(1.05);
        }
        
        /* éœæ…‹å®šä½æ–‡å­— (è«è˜­è¿ªç°è—è‰²å¸¶å…‰æšˆ) */
        .static-text {
            position: fixed;
            color: var(--morandi-blue); 
            font-weight: 400; 
            letter-spacing: 3px; 
            z-index: 15;
            font-family: 'Vidaloka', 'Georgia', serif; 
            text-shadow: 
                0 0 5px rgba(169, 183, 199, 0.8), 
                0 0 15px rgba(169, 183, 199, 0.6), 
                0 0 30px rgba(169, 183, 199, 0.4); 
        }

        #text-top-left {
            top: 20px;
            left: 20px;
            font-size: 3em; 
        }

        #text-bottom-right {
            bottom: 20px;
            right: 20px;
            font-size: 1.8em; 
            text-align: right;
            opacity: 0.9;
        }
        
        /* æŒ‡ç¤ºæ–‡å­—ä½ç½® */
        .instructions {
            position: fixed;
            top: 60px; 
            right: 20px;
            font-size: 1em;
            opacity: 0.7;
            pointer-events: none;
        }
    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div id="container"></div>

    <div class="static-text" id="text-top-left">To TC</div>
    <div class="static-text" id="text-bottom-right">From Shirley on 2025-12-14</div>
    
    <div id="overlay">
        <div class="instructions">ï¼ˆæ‹–æ›³æˆ–æ»‘å‹•ç•«é¢å¯ç’°ç¹è«æ¯”çƒæ–¯ç’°ï¼‰</div>
    </div>
    
    <button id="audio-prompt">ğŸ¶ é»æ­¤æ’­æ”¾éŸ³æ¨‚</button>

    <script>
        let scene, camera, renderer, controls;
        let starField, mobiusRing, textGroup;
        let clock = new THREE.Clock();
        let isMuted = true; 
        let audio;
        
        const audioUrl = 'https://ducj-creator.github.io/wishes/happy-birthday.mp3'; 

        const M_RADIUS = 18;
        const M_WIDTH = 6;
        const M_NUM_PARTICLES = 40000;
        const ART_FONT = 'Vidaloka, Georgia, serif'; 
        const MORANDI_BLUE = '#A9B7C7'; 
        
        // çˆ†ç‚¸å‹•ç•«ç‹€æ…‹
        let explosionStarted = false;
        const EXPLOSION_DURATION = 3.0; // 3 ç§’çˆ†ç‚¸æ™‚é–“
        const JUMP_START_TIME = 3.5; // 3.5 ç§’å¾Œé–‹å§‹è·³å‹•

        // --- è«æ¯”çƒæ–¯ç’°çš„åƒæ•¸åŒ–æ–¹ç¨‹å‡½æ•¸ (é«”ç©é») ---
        function getMobiusPoint(u, v, radius = M_RADIUS, width = M_WIDTH) {
            let t = u * 2 * Math.PI; 
            let offset = v * width; 
            
            let x = (radius + offset * Math.cos(t / 2)) * Math.cos(t);
            let y = (radius + offset * Math.cos(t / 2)) * Math.sin(t);
            let z = offset * Math.sin(t / 2);
            return new THREE.Vector3(x, y, z);
        }

        // --- è«æ¯”çƒæ–¯ç’°çš„ä¸­å¿ƒè»Œè·¡ (ç”¨æ–¼æ–‡å­—) ---
        function getMobiusPath(t, radius = M_RADIUS, width = M_WIDTH) {
            t = t * 2 * Math.PI; 
            let x = radius * Math.cos(t);
            let y = radius * Math.sin(t);
            let z = width * Math.sin(t / 2) * 2; 
            return new THREE.Vector3(x, y, z);
        }
        
        // --- åˆå§‹åŒ–å ´æ™¯ (ç©©å®šç‰ˆ) ---
        function init() {
            if (!window.WebGLRenderingContext) {
                 alert("æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æŒ WebGLï¼Œ3D è³€å¡ç„¡æ³•é¡¯ç¤ºã€‚");
                 return;
            }
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x08122C); 
            document.getElementById('container').appendChild(renderer.domElement);

            scene = new THREE.Scene();
            
            // å¼·åˆ¶å…‰æºï¼šé«˜å¼·åº¦é»å…‰æº (é€™æ˜¯ç¢ºä¿ä¸é»‘å±çš„é—œéµ)
            const pointLight = new THREE.PointLight(0xFFFFFF, 5.0, 100);
            pointLight.position.set(0, 5, 20); 
            scene.add(pointLight);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 30; 
            
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true; 
            controls.dampingFactor = 0.05;
            controls.autoRotate = true; 
            controls.autoRotateSpeed = 0.5;
            controls.maxDistance = 80; 
            controls.minDistance = 15; 
            controls.enablePan = false; 

            // å»ºç«‹æ‰€æœ‰è¦–è¦ºå…ƒç´ 
            createStarField();
            createMobiusRingVisual(); 
            createTextSentences(); 

            window.addEventListener('resize', onWindowResize, false);
            animate();
        }
        
        // --- è«æ¯”çƒæ–¯ç’°è¦–è¦ºæ•ˆæœ (é‰‘é‡‘è‰²ç´°ç²’) ---
        function createMobiusRingVisual() {
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(M_NUM_PARTICLES * 3);
            const colors = new Float32Array(M_NUM_PARTICLES * 3);
            const color = new THREE.Color();
            
            const material = new THREE.PointsMaterial({
                size: 0.15, // ç´°ç²’å­
                vertexColors: true, 
                blending: THREE.AdditiveBlending, 
                transparent: true,
                opacity: 1.0, 
                sizeAttenuation: true
            });
            
            for (let i = 0; i < M_NUM_PARTICLES; i++) {
                const u = Math.random() * 1.0; 
                const v = Math.random() * 2 - 1; 
                
                const point = getMobiusPoint(u, v, M_RADIUS, M_WIDTH);
                
                positions[i * 3] = point.x;
                positions[i * 3 + 1] = point.y;
                positions[i * 3 + 2] = point.z;

                // é‰‘é‡‘è‰²é…ç½®ï¼šå†·è‰²èª¿ (è—/ç´«)ï¼Œé«˜é£½å’Œï¼Œé«˜äº®åº¦
                color.setHSL(0.6 + Math.random() * 0.1, 0.8, 0.8 + Math.random() * 0.2); 

                colors[i * 3] = color.r;
                colors[i * 3 + 1] = color.g;
                colors[i * 3 + 2] = color.b;
            }
            
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

            mobiusRing = new THREE.Points(geometry, material);
            scene.add(mobiusRing);
        }
        
        // --- 3D ç¥è³€å¥å­ (è«è˜­è¿ªç°è—è‰²) ---
        function createTextSentences() {
            textGroup = new THREE.Group();
            scene.add(textGroup);

            const sentences = [
                { text: "Happy Birthday", color: MORANDI_BLUE, scale: 2.0 }, 
                { text: "ç”Ÿæ—¥å¿«æ¨‚", color: MORANDI_BLUE, scale: 1.5 }, 
                { text: "èº«é«”å¥åº·", color: MORANDI_BLUE, scale: 1.5 }  
            ];
            
            function createTextSprite(sentence, sentenceColor, sizeScale) {
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                
                const FONT_SIZE = 48 * sizeScale;
                context.font = `Bold ${FONT_SIZE}px 'Vidaloka', 'Georgia', serif`; 
                
                const metrics = context.measureText(sentence);
                const textWidth = metrics.width;
                
                canvas.width = textWidth + 40;
                canvas.height = 80 * sizeScale;
                
                context.font = `Bold ${FONT_SIZE}px 'Vidaloka', 'Georgia', serif`;
                context.fillStyle = sentenceColor; 
                
                context.shadowColor = 'rgba(255, 255, 255, 0.6)'; 
                context.shadowBlur = 10;
                
                context.textAlign = 'center';
                context.textBaseline = 'middle';
                context.fillText(sentence, canvas.width / 2, canvas.height / 2);
                
                const texture = new THREE.CanvasTexture(canvas);
                
                const material = new THREE.SpriteMaterial({ 
                    map: texture, 
                    transparent: true, 
                    blending: THREE.AdditiveBlending,
                    color: new THREE.Color(sentenceColor).multiplyScalar(1.5) 
                });
                const sprite = new THREE.Sprite(material);
                
                sprite.scale.set(1.5 * textWidth / 48, 1.5 * sizeScale, 1.0); 
                
                // åˆå§‹ä½ç½®è¨­å®šç‚ºåŸé» (çˆ†ç‚¸èµ·é»)
                sprite.position.set(0, 0, 0); 
                return sprite;
            }

            sentences.forEach((s, i) => {
                const sprite = createTextSprite(s.text, s.color, s.scale);
                sprite.userData.phase = i * Math.PI / 3; 
                sprite.userData.pathIndex = i; 
                sprite.userData.targetPos = getMobiusPath(sprite.userData.pathIndex / sentences.length);
                textGroup.add(sprite);
            });
        }
        
        // --- èƒŒæ™¯æ˜Ÿå¡µ ---
        function createStarField() {
            const starGeometry = new THREE.BufferGeometry();
            const starCount = 15000;
            const positions = [];
            const colors = [];
            const color = new THREE.Color();
            const spread = 300; 

            for (let i = 0; i < starCount; i++) {
                positions.push(
                    (Math.random() - 0.5) * spread,
                    (Math.random() - 0.5) * spread,
                    (Math.random() - 0.5) * spread
                );
                // æ˜Ÿå¡µä¿æŒæ·±ç©ºæš–å…‰
                color.setHSL(0.1, 0.5, 0.8 + Math.random() * 0.2); 
                colors.push(color.r, color.g, color.b);
            }

            starGeometry.setAttribute('position', new THREE.BufferAttribute(new Float32Array(positions), 3));
            starGeometry.setAttribute('color', new THREE.BufferAttribute(new Float32Array(colors), 3));

            const starMaterial = new THREE.PointsMaterial({
                size: 0.2, 
                vertexColors: true,
                blending: THREE.AdditiveBlending,
                transparent: true,
                sizeAttenuation: true 
            });

            starField = new THREE.Points(starGeometry, starMaterial);
            scene.add(starField);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // --- å‹•ç•«å¾ªç’° ---
        function animate() {
            requestAnimationFrame(animate);

            const elapsedTime = clock.getElapsedTime();
            
            if (starField) {
                starField.rotation.y += 0.0002;
            }
            
            if (mobiusRing) {
                mobiusRing.rotation.z += 0.0005; 
                
                // æ–°å¢ï¼šè«æ¯”çƒæ–¯ç’°æ•´é«”æ²¿ Z è»¸è·³å‹•
                mobiusRing.position.z = Math.sin(elapsedTime * 1.5) * 1.0; // é »ç‡ 1.5ï¼Œå¹…åº¦ 1.0
            }
            
            if (textGroup) {
                // å»¶é²çˆ†ç‚¸å‹•ç•«ï¼Œç”¨ Three.js å…§å»ºæ–¹æ³•åŸ·è¡Œ
                if (!explosionStarted && elapsedTime >= 0.5) { 
                    explosionStarted = true;
                }

                if (explosionStarted) {
                    // è¨ˆç®—çˆ†ç‚¸é€²åº¦ (å¾ 0 åˆ° 1)
                    let progress = (elapsedTime - 0.5) / EXPLOSION_DURATION; 
                    progress = Math.min(1.0, progress); 
                    
                    // å¹³æ»‘éæ¸¡å‡½æ•¸ (é¡ Exponential.Out)
                    const easedProgress = 1 - Math.pow(1 - progress, 3);

                    textGroup.children.forEach((sprite, i) => {
                        const target = sprite.userData.targetPos;
                        const current = sprite.position;

                        if (progress < 1.0) {
                            // ç·šæ€§æ’å€¼ï¼šå¾ (0, 0, 0) å¹³æ»‘éæ¸¡åˆ°ç›®æ¨™ä½ç½®
                            current.x = THREE.MathUtils.lerp(0, target.x, easedProgress);
                            current.y = THREE.MathUtils.lerp(0, target.y, easedProgress);
                            current.z = THREE.MathUtils.lerp(0, target.z, easedProgress);
                        } else {
                            // çˆ†ç‚¸çµæŸï¼Œé–‹å§‹è«æ¯”çƒæ–¯ç’°ä¸Šçš„è·³å‹•
                            const numSentences = textGroup.children.length;
                            const pathSpread = 1 / numSentences; 
                            
                            const jumpTime = Math.max(0, elapsedTime - JUMP_START_TIME); 
                            const t = jumpTime * 0.05 + sprite.userData.pathIndex * pathSpread; 
                            
                            const centerPos = getMobiusPath(t);
                            const jump = Math.sin(jumpTime * 0.8 + sprite.userData.phase) * 3.0; 
                            
                            sprite.position.x = centerPos.x;
                            sprite.position.y = centerPos.y;
                            // æ–‡å­—çš„è·³å‹•éœ€è¦åŠ ä¸Šè«æ¯”çƒæ–¯ç’°çš„æ•´é«”è·³å‹•ï¼Œä½¿æ–‡å­—è·Ÿéš¨è«æ¯”çƒæ–¯ç’°ä¸€èµ·å‹•
                            sprite.position.z = centerPos.z + jump + mobiusRing.position.z; 
                        }
                    });
                }
            }
            
            controls.update(); 
            renderer.render(scene, camera);
        }

        // --- è²éŸ³æ§åˆ¶é‚è¼¯ (èˆ‡ Three.js ç¨ç«‹) ---
        function updateAudioButton(muted) {
            const prompt = document.getElementById('audio-prompt');
            if (muted) {
                prompt.innerHTML = 'ğŸ¶ é»æ­¤æ’­æ”¾éŸ³æ¨‚';
                prompt.style.backgroundColor = 'rgba(44, 62, 80, 0.9)';
            } else {
                prompt.innerHTML = 'ğŸ”‡ éœéŸ³';
                prompt.style.backgroundColor = 'rgba(231, 76, 60, 0.9)';
            }
        }

        function toggleAudio() {
            if (!audio) return; 

            if (isMuted) {
                audio.muted = false;
                audio.play().then(() => {
                    isMuted = false;
                    updateAudioButton(false);
                }).catch(e => {
                    console.error("éŸ³æ¨‚æ’­æ”¾å¤±æ•—ã€‚", e);
                    isMuted = false;
                    updateAudioButton(false);
                });
            } else {
                audio.muted = true;
                isMuted = true;
                updateAudioButton(true);
            }
        }

        function setupAudio() {
            audio = new Audio(audioUrl);
            audio.loop = true; 
            audio.volume = 0.5;
            
            document.getElementById('audio-prompt').addEventListener('click', toggleAudio);
            updateAudioButton(true); 
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            setupAudio();
            init();
        });
    </script>
</body>
</html>
